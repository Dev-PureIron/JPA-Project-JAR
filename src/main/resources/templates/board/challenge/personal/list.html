<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개인 챌린지 게시판 목록</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/board/challenge/challenge-list.css">
    <link rel="icon" href="/image/logo/favicon.png">
    <link rel="stylesheet" href="/css/main/header.css">
    <link rel="stylesheet" href="/css/main/footer.css">
</head>
<body>
    <div class="__next">
        <div id="wrapper">
            <th:block th:replace="~{main/header :: header}"></th:block>
            <div class="main">
                <div class="main-wrapper">
                    <section class="main-wrapper-section">
                        <section class="main-wrapper-section-box">
                            <section class="main-wrapper-section-box-layout">
                                <div class="main-wrapper-section-box-layout-wrap wrap-1">
                                    <h2>개인 챌린지 </h2>
                                    <div class="div-line" top="0" right="0" bottom="24" left="0"></div>
                                    <div class="main-top">
                                        <section class="main-top-wrap">
                                            <section class="main-top-wrap-box">
                                                <button class="currently-challenge select-button challenge challenge-1 challenge-2 select-button-active"
                                                        value="0" icon-position="0" color="default" fill="false">
                                                    <span>진행중인 챌린지</span>
                                                </button>
                                                <button class="closing-challenge select-button challenge challenge-1 challenge-2"
                                                        value="1" icon-position="0" color="default" fill="false">
                                                    <span>종료된 챌린지</span>
                                                </button>
                                            </section>
                                        </section>
                                    </div>
                                    <div class="div-line" top="0" right="0" bottom="24" left="0"></div>
                                    <div class="challenge-wrapper">
                                        <div class="challenge-line" top="[object Object]" right="0" buttom="0" left="0"></div>
                                        <div class="challenge-wrapper-main">
                                            <div class="challenge-wrapper-main-box">

                                                <ul smcolumn="2" class="challenge-wrapper-list">
<!--                                                    <li smcolumn="2" lgcolumn="3" class="challenge-board">-->
<!--                                                        <div class="challenge-board-box">-->
<!--                                                            <a href=""  class="challenge-board-box-a">-->
<!--                                                                <div class="challenge-board-box-a-box">-->
<!--                                                                    <div class="board-box">-->
<!--                                                                        <span class="board-box-span-1 board-box-span-2">-->
<!--                                                                            <picture class="board-box-picture" ratio="0.75">-->
<!--                                                                                <img sizes="(min-width: 1024px) 300px, 50vw" src="/image/board/board-img.png" alt="챌린지 게시판" class="board-box-picture-img">-->
<!--                                                                            </picture>-->
<!--                                                                            &lt;!&ndash; <div class="board-box-heart">-->
<!--                                                                                <button class="heart-button heart button-heart">-->
<!--                                                                                    <span class="heart-span">-->
<!--                                                                                        <svg width="24" height="25" fill="none" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M20.5 9c0-2-1.5-3.9-3.7-3.9-2.3 0-3.8 1.63-4.8 3.33-1-1.7-2.5-3.33-4.8-3.33C5 5.1 3.5 6.867 3.5 9c0 4.62 4.949 7.667 8.5 9.623 3.551-1.956 8.5-5.003 8.5-9.623zm-19-.176C1.5 5.607 3.962 3 7 3c2.7 0 4 1 5 2.2C13 4 14.3 3 17 3c3.038 0 5.5 2.607 5.5 5.824C22.5 14.827 16.684 18.52 12 21 7.316 18.52 1.5 14.827 1.5 8.824z" fill="#FFF"></path></svg>-->
<!--                                                                                    </span>-->
<!--                                                                                </button>-->
<!--                                                                            </div> &ndash;&gt;-->
<!--                                                                        </span>-->
<!--                                                                    </div>-->
<!--                                                                    <div class="">-->
<!--                                                                        <div class="board-container-1">-->
<!--                                                                            <p class="board-container-name">곽두철</p>-->
<!--                                                                        </div>-->
<!--                                                                        <div class="board-container-2">곽두철의 폭행, 공갈협박, 공중제비, 아리랑치기 전문가가 되는 법, 곽두철의 독학 비법서</div>-->
<!--                                                                        <div class="board-container-3">-->
<!--                                                                            <div class="board-container-set">-->
<!--                                                                                <div class="board-container-set-wrap" data-test-group="product-card-wishlited-count1">-->
<!--                                                                                    <div class="board-container-set-box">-->
<!--                                                                                        <img src="/image/board/human-icon.png" alt="" class="human-icon">-->
<!--                                                                                        &lt;!&ndash; <svg width="12" height="12" fill="none" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M1.5 8.824C1.5 5.607 3.962 3 7 3c2.5 0 4 1.5 5 3 1-1.5 2.5-3 5-3 3.038 0 5.5 2.607 5.5 5.824C22.5 14.827 16.684 18.52 12 21 7.316 18.52 1.5 14.827 1.5 8.824z" fill="#d7d7d7"></path></svg> &ndash;&gt;-->
<!--                                                                                        51832-->
<!--                                                                                    </div>-->
<!--                                                                                </div>-->
<!--                                                                                <div class="board-container-set-like" data-test-group="product-card-like-count">-->
<!--                                                                                    <div class="board-container-set-box">-->
<!--                                                                                        <img src="/image/board/reply-icon.png" alt="" class="reply-icon">-->
<!--                                                                                        &lt;!&ndash; <svg width="12" height="12" fill="none" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M2 10.68c0-.691.503-1.251 1.135-1.251h2.273V22H3.135C2.508 22 2 21.427 2 20.749V10.68zm11.361-2.508h6.366c1.255 0 2.272 1.126 2.272 2.514 0 .151-.012.301-.037.45l-1.616 9.832C20.25 21.566 19.779 22 19.23 22H7.681V9.429L11.089 0c1.704 0 2.84 1.257 2.84 3.143 0 1.257-.189 2.933-.568 5.029z" fill="#d7d7d7"></path></svg> &ndash;&gt;-->
<!--                                                                                        302-->
<!--                                                                                    </div>-->
<!--                                                                                </div>-->
<!--                                                                            </div>-->
<!--                                                                        </div>-->
<!--                                                                    </div>-->
<!--                                                                    <div class="board-box-line"></div>-->
<!--                                                                    <div class="board-box-line-flex"></div>-->
<!--                                                                </div>-->
<!--                                                            </a>-->
<!--                                                        </div>-->
<!--                                                    </li>-->
                                                </ul>

                                            </div>
                                            <div></div>
                                            <div class="paging-box">
                                                <div class="paging-layout">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </section>
                    </section>
                </div>
            </div>
            <th:block th:replace="~{main/footer :: footer}"></th:block>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>

    /* 진행중인 챌린지 / 종료된 챌린지 */
    let currentlyBtn = document.querySelector('.currently-challenge');
    let closingBtn = document.querySelector('.closing-challenge');

    let $selectButton = $(".select-button");

    $selectButton.each((i, e) => {
        $(e).click(() => {
            $selectButton.removeClass("select-button-active");
            $(e).addClass("select-button-active");
        });
    });
</script>
<script>

    const $ul = $(".challenge-wrapper-list");
    let page = 0;
    let challengeStatus= "OPEN";

    groupChallengeService = (function () {
        function list(page, callback) {
            $.ajax({
                url: '/board/challenge/personal/list-content',
                type: 'get',
                data: page,
                success: function (list) {
                    if (callback) {
                        callback(list);
                    }
                }
            });
        }

        return {
            list: list,
        }
    })();
    getList(challengeStatus, page);

    $(".currently-challenge").click(() => {
        $ul.empty();
        page = 0;
        challengeStatus = "OPEN";
        getList(status, page);
    });

    $(".closing-challenge ").click(() => {
        page = 0;
        challengeStatus = "PRIVATE";
        $ul.empty();
        getList(status, page);
    });


    $(".paging-layout").on("click", "a", function(e) {
        e.preventDefault();
        $ul.empty();
        const targetPage = $(this).text();

        if ($(this).hasClass("arrow")) {
            // 화살표 클릭 시 이전 페이지 또는 다음 페이지로 이동
            if ($(this).attr("id") === "prev") {
                page--;
            } else if ($(this).attr("id") === "next") {
                page++;
            }
        } else {
            // 페이지 번호 클릭 시 해당 페이지로 이동
            page = parseInt(targetPage) - 1;
        }

        getList(challengeStatus, page);
    });

    function displayPagination(totalPages) {
        const $pagination = $(".paging-layout");
        $pagination.empty();

        if (page > 0) {
            $pagination.append("<a href='#' class='arrow' id='prev'><img class='prev'  src='/image/mypage/arrow.png'></a>");
        }

        for (let i = 1; i <= totalPages; i++) {
            if (i === page + 1) {
                // 현재 페이지를 텍스트로 표시
                $pagination.append(
                    "<div class='paging-border-none paging-active'><span class='page'>" + i + "</span></div>"
                );
            } else {
                // 다른 페이지는 a 태그로 표시
                $pagination.append("<div class='paging-border-none'><a href='#' class='page'>" + i + "</a></div>");
            }
        }
        if (page < totalPages - 1) {
            $pagination.append("<a href='#' class='arrow' id='next'><img class='next' src='/image/mypage/arrow.png'></a>");
        }
    }

    function listText(list) {
        let personalChallengeDTOS = list.content;

        $(personalChallengeDTOS).each((i, personalChallengeDTO) => {
            let text = `
                                                <li smcolumn="2" lgcolumn="3" class="challenge-board">
                                                        <div class="challenge-board-box">
                                                            <a href="/board/challenge/personal/detail/${personalChallengeDTO.id}"  class="challenge-board-box-a">
                                                                <div class="challenge-board-box-a-box">
                                                                    <div class="board-box">
                                                                        <span class="board-box-span-1 board-box-span-2">
                                                                            <picture class="board-box-picture" ratio="0.75">
                                                                            `;
            if(personalChallengeDTO.challengeDTO.fileDTOS.length == 0 || personalChallengeDTO.challengeDTO.fileDTOS == null || personalChallengeDTO.challengeDTO.fileDTOS == undefined){
                text += `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/480px-No_image_available.svg.png" class="no-image">`;
            }else {
                for (let  j= 0; j < personalChallengeDTO.challegeDTO.fileDTOS.length; j++){
                    if(personalChallengeDTO.challengeDTO.fileDTOS[j].fileType === "REPRESENTATIVE"){
                        text += `<img class="list-image"  src="/file/display?fileName=${personalChallengeDTO.challengeDTO.fileDTOS[j].filePath}/${personalChallengeDTO.challengeDTO.fileDTOS[j].fileUuid}_${personalChallengeDTO.challengeDTO.fileDTOS[j].fileOriginalName}">`;
                    }
                }
            }

            text +=                                        `        </picture>
                                                                        </span>
                                                                    </div>
                                                                    <div class="">
                                                                        <div class="board-container-1">
                                                                            <p class="board-container-name">${personalChallengeDTO.challengeDTO.boardTitle}</p>
                                                                        </div>
                                                                        <div class="board-container-2">${personalChallengeDTO.challengeDTO.boardContent}</div>
                                                                        <div class="board-container-3">
                                                                            <div class="board-container-set">
                                                                                <div class="board-container-set-wrap" data-test-group="product-card-wishlited-count1">
                                                                                    <div class="board-container-set-box">
                                                                                        <img src="/image/board/human-icon.png" alt="" class="human-icon">
                                                                                       <span>${personalChallengeDTO.attendCount}</span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="board-container-set-like" data-test-group="product-card-like-count">
                                                                                    <div class="board-container-set-box">
                                                                                        <img src="/image/board/reply-icon.png" alt="" class="reply-icon">
                                                                                        <span>${personalChallengeDTO.replyCount}</span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="board-box-line"></div>
                                                                    <div class="board-box-line-flex"></div>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </li>

        `;
            $ul.append(text);
        });

    }

    function getList(status, page){
        groupChallengeService.list({
            page: page,
            challengeStatus : challengeStatus
        }, function (list) {
            window.scrollTo(0, 0);
            listText(list);
            displayPagination(list.totalPages);
        })
    }

</script>
</html>